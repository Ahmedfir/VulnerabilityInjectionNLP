path_output_java_file = "C:\\Users\\benjamin.petit\\docker\\scripts_python\\output.txt"


def check_output(i, line):
    if CWE129(line): return(f"CWE129 at line {i} of the output")
    if CWE134(line): return(f"CWE134 at line {i} of the output")
    if CWE190(line): return(f"CWE190 at line {i} of the output")
    if CWE191(line): return(f"CWE191 at line {i} of the output")
    if CWE369(line): return(f"CWE369 at line {i} of the output")


def CWE129(line):
    if "EXCEPTION = java.lang.ArrayIndexOutOfBoundsException" in line:
        return True

def CWE134(line):
    if "EXCEPTION = java.util.MissingFormatArgumentException" in line:
        return True

def CWE190(line):
    if line.startswith("<CWE190>"):
        # If the comparison between the int and the BigInteger are not the same there is an issue
        if line[8:].startswith("false"):
            return True

def CWE191(line):
    if line.startswith("<CWE191>"):
        # If the comparison between the int and the BigInteger are not the same there is an issue
        if line[8:].startswith("false"):
            return True

def CWE369(line):
    if "EXCEPTION = java.lang.ArithmeticException: / by zero" in line:
        return True


def main():
    with open(path_output_java_file, 'r') as output_file:
        CWE_list = ["CWE129","CWE134","CWE190","CWE191","CWE369"]
        CWE_catched = []
        for i,line in enumerate(output_file):
            check_output_line = check_output(i, line)
            if check_output_line is not None:
                CWE_catched.append(check_output(i,line))

        #print(CWE_catched)
        for cwe in CWE_list:
            print(f"{cwe} : {len([x for x in CWE_catched if x.startswith(cwe)])}")

if __name__ == "__main__":
    main()