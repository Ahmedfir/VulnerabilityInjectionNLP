import os
from confuzzion import compile_and_run_mutant

OS = "Windows" #Linux or Windows

# To be use when all the java files , testcasesupport and lib are on the same folder
def compile_one_java_file(java_file):
    separator = ";"
    if OS == "linux":
        separator = ":"

    print("Compile " + java_file)
    command = f"javac -cp lib/servlet-api.jar{separator}" \
              f"lib/commons-lang-2.5.jar{separator}" \
              f"lib/commons-codec-1.5.jar{separator}" \
              f"lib/javamail-1.4.4.jar " \
              f"testcasesupport/*.java " \
              f"{java_file}"
    #print(command)
    os.system(command)


def compile_all_java_files(path_to_folder):
    print("Compilation of all java file in the folder : ")
    print(path_to_folder)
    os.chdir(path_to_folder)
    for file in [file for file in os.listdir() if file.endswith(".java")]:
        # Remove package line
        compile_and_run_mutant.modify_line_in_java_file(file, "package", "")
        compile_one_java_file(file)

if __name__ == "__main__":
    folder_path= "C:\\Users\\benjamin.petit\\Documents\\Seq2seq\\OpenNMT_5CWE_InferOK_token_less_150_Obfuscated\\fold0\\results\\test_beam5_iter10000"
    # Remove the package line in the java files and then compile
    compile_all_java_files(folder_path)
    # Remove all the not compilable java files
    # TBD
    # MANUALLY insert the build.xml for infer